<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>部署指南 | image-manage</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/docsimg/favicon.ico">
    <meta name="description" content="一个基于k8s的分布式图床">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/docs/assets/css/0.styles.18f90ef5.css" as="style"><link rel="preload" href="/docs/assets/js/app.486e4ca0.js" as="script"><link rel="preload" href="/docs/assets/js/2.6ed8e9a4.js" as="script"><link rel="preload" href="/docs/assets/js/7.9dc9e7d1.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.c6b0d101.js"><link rel="prefetch" href="/docs/assets/js/11.f093b7d6.js"><link rel="prefetch" href="/docs/assets/js/12.19c60dff.js"><link rel="prefetch" href="/docs/assets/js/13.58683ac1.js"><link rel="prefetch" href="/docs/assets/js/14.26444a92.js"><link rel="prefetch" href="/docs/assets/js/15.e56598ca.js"><link rel="prefetch" href="/docs/assets/js/3.5dc01cf3.js"><link rel="prefetch" href="/docs/assets/js/4.8ff3daec.js"><link rel="prefetch" href="/docs/assets/js/5.9db1bcee.js"><link rel="prefetch" href="/docs/assets/js/6.5c260d2b.js"><link rel="prefetch" href="/docs/assets/js/8.192030a6.js"><link rel="prefetch" href="/docs/assets/js/9.9ba19139.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.18f90ef5.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docsimg/logo.png" alt="image-manage" class="logo"> <span class="site-name can-hide">image-manage</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/docs/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/pages/a2f161/" class="nav-link">介绍</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/793dcb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">快速上手</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/2f674a/" class="nav-link">目录结构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="核心功能" class="dropdown-title"><a href="/docs/pages/a20ce8/" class="link-title">核心功能</a> <span class="title" style="display:none;">核心功能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/pages/a20ce8/" class="nav-link">数据的存储</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/f14bdb/" class="nav-link">数据的同步机制</a></li></ul></div></div> <a href="https://github.com/wnzzer/image-manage" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/docs/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/pages/a2f161/" class="nav-link">介绍</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/793dcb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">快速上手</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/2f674a/" class="nav-link">目录结构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="核心功能" class="dropdown-title"><a href="/docs/pages/a20ce8/" class="link-title">核心功能</a> <span class="title" style="display:none;">核心功能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/pages/a20ce8/" class="nav-link">数据的存储</a></li><li class="dropdown-item"><!----> <a href="/docs/pages/f14bdb/" class="nav-link">数据的同步机制</a></li></ul></div></div> <a href="https://github.com/wnzzer/image-manage" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/pages/a2f161/" class="sidebar-link">介绍</a></li><li><a href="/docs/pages/793dcb/" aria-current="page" class="active sidebar-link">部署指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/docs/pages/793dcb/#单机部署-docker" class="sidebar-link">单机部署(docker)</a></li><li class="sidebar-sub-header level2"><a href="/docs/pages/793dcb/#集群部署部署-k8s" class="sidebar-link">集群部署部署(k8s)</a></li></ul></li><li><a href="/docs/pages/2f674a/" class="sidebar-link">目录结构</a></li><li><a href="/docs/pages/33d574/" class="sidebar-link">构建结构化站点的核心配置和约定</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="placeholder"></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">部署指南<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block warning"><p class="custom-block-title">注意⚠️</p> <ol><li>你需要至少一个mysql数据库</li> <li>你需要至少一个redis数据库</li> <li>你需要一个版本至少 kubernetes 1.29的集群(集群可选)</li></ol></div> <h2 id="单机部署-docker"><a href="#单机部署-docker" class="header-anchor">#</a> 单机部署(docker)</h2> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-bash extra-class" data-v-4f1e9d0c><pre class="language-bash" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token comment" data-v-4f1e9d0c># clone the project</span>
<span class="token function" data-v-4f1e9d0c>docker</span> run <span class="token parameter variable" data-v-4f1e9d0c>-p</span> <span class="token number" data-v-4f1e9d0c>8080</span>:8080 <span class="token punctuation" data-v-4f1e9d0c>\</span>
 <span class="token parameter variable" data-v-4f1e9d0c>-v</span>  你的数据目录:/app<span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>CONFIG_ISCLUSTERMODEENABLED</span><span class="token operator" data-v-4f1e9d0c>=</span>flase <span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>SPRING_DATASOURCE_URL</span><span class="token operator" data-v-4f1e9d0c>=</span>jdbc:mysql://192.168.0.254:3306/image_manage?userUnicode<span class="token operator" data-v-4f1e9d0c>=</span>true<span class="token operator" data-v-4f1e9d0c>&amp;</span><span class="token assign-left variable" data-v-4f1e9d0c>characterEncoding</span><span class="token operator" data-v-4f1e9d0c>=</span>utf-8<span class="token operator" data-v-4f1e9d0c>&amp;</span><span class="token assign-left variable" data-v-4f1e9d0c>useSSL</span><span class="token operator" data-v-4f1e9d0c>=</span>false<span class="token operator" data-v-4f1e9d0c>&amp;</span><span class="token assign-left variable" data-v-4f1e9d0c>serverTimezone</span><span class="token operator" data-v-4f1e9d0c>=</span>Asia/Shanghai <span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>SPRING_DATASOURCE_USERNAME</span><span class="token operator" data-v-4f1e9d0c>=</span>root <span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>SPRING_DATASOURCE_PASSWORD</span><span class="token operator" data-v-4f1e9d0c>=</span><span class="token number" data-v-4f1e9d0c>123456</span> <span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>SPRING_REDIS_HOST</span><span class="token operator" data-v-4f1e9d0c>=</span><span class="token number" data-v-4f1e9d0c>192.168</span>.0.254 <span class="token punctuation" data-v-4f1e9d0c>\</span>
  <span class="token parameter variable" data-v-4f1e9d0c>-e</span> <span class="token assign-left variable" data-v-4f1e9d0c>SPRING_REDIS_PASSWORD</span><span class="token operator" data-v-4f1e9d0c>=</span><span class="token number" data-v-4f1e9d0c>123456</span> <span class="token punctuation" data-v-4f1e9d0c>\</span>
  wnzzer/image-manage:latest
<span class="token comment" data-v-4f1e9d0c># 这里配置数据挂载卷，mysql，数据库和redis数据库</span>
</code></pre></div><blockquote data-v-4f1e9d0c><p data-v-4f1e9d0c>仓库地址： <a href="https://github.com/wnzzer/image-manage" target="_blank" rel="noopener noreferrer" data-v-4f1e9d0c>https://github.com/wnzzer/image-manage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ol><li>由于springboot的配置替换策略，如果要替换更多的springboot参数配置也是可行的</li></ol></div> <h2 id="集群部署部署-k8s"><a href="#集群部署部署-k8s" class="header-anchor">#</a> 集群部署部署(k8s)</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ol><li>这是应用监控资源必须的组件，如果没有该组件，k8s metrics api将无法工作，image-manage将无法搜集pod资源信息</li></ol></div> <ol><li>安装最metrics server：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>kubectl apply <span class="token parameter variable">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</code></pre></div><ol start="2"><li>创建image-manage应用</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span>  https://github.com/wnzzer/image-manage/releases/latest/download/image-manage-yaml
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage

<span class="token punctuation">---</span>
<span class="token comment"># storeclass 声明，非常关键，用于动态分配卷</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>store<span class="token punctuation">-</span>class
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>provisioner  <span class="token comment"># 替换为实际的卷插件，我这里使用的是nfs的自动供应器，可以采用公用云或者其他pv自动供应器</span>
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumeSize</span><span class="token punctuation">:</span> <span class="token string">&quot;1Gi&quot;</span>  <span class="token comment"># 应用存储图片的空间</span>
  <span class="token key atrule">nfsServer</span><span class="token punctuation">:</span> 192.168.0.254
  <span class="token key atrule">nfsPath</span><span class="token punctuation">:</span> /volume1/nfs

<span class="token punctuation">---</span>
<span class="token comment"># configMap k8s权限配置到英雄</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
  <span class="token key atrule">name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>role<span class="token punctuation">-</span>config
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">key1</span><span class="token punctuation">:</span> ./admin.config

<span class="token punctuation">---</span>

<span class="token comment"># 应用</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
  <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;image-manage-headless-service&quot;</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
        <span class="token key atrule">image</span><span class="token punctuation">:</span> wnzzer/image<span class="token punctuation">-</span>manage<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_PROFILES_ACTIVE
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;prod&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CONFIG_ISCLUSTERMODEENABLED
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;false&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_DATASOURCE_URL
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;jdbc:mysql://192.168.0.254:3306/image_manage?userUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_DATASOURCE_USERNAME
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;root&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_DATASOURCE_PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_REDIS_HOST
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;192.168.0.254&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SPRING_REDIS_PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>vol
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/app&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume  <span class="token comment"># 挂载ConfigMap作为卷</span>
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/etc/image-manage/config&quot;</span>  <span class="token comment"># 指定挂载ConfigMap的路径</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume  <span class="token comment"># 定义卷使用的ConfigMap</span>
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>admin<span class="token punctuation">-</span>role<span class="token punctuation">-</span>config  <span class="token comment"># 指定ConfigMap的名称</span>
  <span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>vol
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;ReadWriteOnce&quot;</span> <span class="token punctuation">]</span>
      <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">&quot;nfs-store-class&quot;</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">requests</span><span class="token punctuation">:</span>
          <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi

<span class="token punctuation">---</span>
<span class="token comment"># 无头服务,用于应用的同步通信</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage<span class="token punctuation">-</span>headless<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>


<span class="token punctuation">---</span>
<span class="token comment"># cluster service 用于输出api</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>manage
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>kubectl apply <span class="token parameter variable">-f</span> image-manage.yaml
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <ol><li>这里同样需要把redis，mysql修改成自己的配置</li> <li>这里需要有自己的pv供应器，由于是pv动态创建，所以需要搭配自动供应器给statusfulSet创建pv，示例中使用的是nfs</li> <li>image-manage 需要搭配 k8s 配置进行对k8s api的访问，这里实例使用的是admin.conf,使用configmap挂载到容器里，如果想要更细致的权限划分，请将权限配置至少给予 image-manage级别的权限。</li> <li>创建的k8s用户文件请将命名为admin.conf,因为应用里指定了k8s配置文件为admin.conf，其他名称会无法读取。</li></ol></div> <ol start="3"><li>访问</li></ol> <p>我们可以直接在k8s中部署nginx，反代 image-manage cluster ip，进行访问，</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/4/2023, 5:31:27 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/docs/pages/a2f161/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">介绍</div></a> <a href="/docs/pages/2f674a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">目录结构</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/pages/a2f161/" class="prev">介绍</a></span> <span class="next"><a href="/docs/pages/2f674a/">目录结构</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wnzzer" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>wnzzer | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.486e4ca0.js" defer></script><script src="/docs/assets/js/2.6ed8e9a4.js" defer></script><script src="/docs/assets/js/7.9dc9e7d1.js" defer></script>
  </body>
</html>
